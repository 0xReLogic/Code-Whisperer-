# Code Whisperer Data Structures

## Overview

This document defines the core data structures used in Code Whisperer for representing coding patterns, user preferences, and learning data.

## Core Data Structures

### CodingPattern

Represents a detected coding pattern with associated metadata.

```rust
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct CodingPattern {
    /// Unique identifier for the pattern
    pub id: String,
    /// Type of pattern (e.g., "function_definition", "loop_construct")
    pub pattern_type: PatternType,
    /// Programming language this pattern applies to
    pub language: String,
    /// Pattern content (AST nodes, tokens, etc.)
    pub content: PatternContent,
    /// Confidence score (0.0 to 1.0)
    pub confidence: f64,
    /// Frequency of occurrence in user's code
    pub frequency: u32,
    /// Last time this pattern was observed
    pub last_seen: DateTime<Utc>,
    /// Source files where this pattern was found
    pub source_files: Vec<String>,
    /// User feedback on this pattern's suggestions
    pub user_feedback: Vec<PatternFeedback>,
}
```

### PatternType

Enumeration of different pattern types.

```rust
#[derive(Debug, Clone, Serialize, Deserialize, PartialEq, Eq, Hash)]
pub enum PatternType {
    // Structural patterns
    FunctionDefinition,
    ClassDefinition,
    LoopConstruct,
    ConditionalStatement,
    VariableDeclaration,
    ImportStatement,

    // Naming patterns
    VariableNaming,
    FunctionNaming,
    ClassNaming,
    ConstantNaming,

    // Style patterns
    IndentationStyle,
    BraceStyle,
    CommentStyle,
    DocumentationStyle,

    // Error handling patterns
    ExceptionHandling,
    ErrorChecking,
    ResourceManagement,

    // Custom patterns
    Custom(String),
}
```

### PatternContent

Represents the actual content of a coding pattern.

```rust
#[derive(Debug, Clone, Serialize, Deserialize)]
pub enum PatternContent {
    /// AST-based pattern representation
    Ast {
        /// Abstract Syntax Tree nodes
        nodes: Vec<AstNode>,
        /// Variable placeholders in the pattern
        variables: HashMap<String, VariableInfo>,
    },

    /// Token-based pattern representation
    Tokens {
        /// Sequence of tokens
        tokens: Vec<Token>,
        /// Token positions and metadata
        metadata: HashMap<usize, TokenMetadata>,
    },

    /// String-based pattern (for simple patterns)
    String {
        /// Pattern as string with placeholders
        pattern: String,
        /// Placeholder definitions
        placeholders: Vec<Placeholder>,
    },
}
```

### AstNode

Represents a node in the Abstract Syntax Tree.

```rust
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct AstNode {
    /// Node type (e.g., "FunctionDeclaration", "IfStatement")
    pub node_type: String,
    /// Node properties
    pub properties: HashMap<String, serde_json::Value>,
    /// Child nodes
    pub children: Vec<AstNode>,
    /// Source code location
    pub location: SourceLocation,
}
```

### Token

Represents a lexical token in source code.

```rust
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct Token {
    /// Token type
    pub token_type: TokenType,
    /// Token value
    pub value: String,
    /// Source location
    pub location: SourceLocation,
}
```

### UserPreferences

Represents user preferences and settings.

```rust
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct UserPreferences {
    /// General settings
    pub general: GeneralPreferences,
    /// Language-specific preferences
    pub languages: HashMap<String, LanguagePreferences>,
    /// Pattern learning settings
    pub learning: LearningPreferences,
    /// UI/UX preferences
    pub ui: UiPreferences,
}
```

### LearningData

Represents data collected for machine learning.

```rust
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct LearningData {
    /// User interactions with suggestions
    pub interactions: Vec<SuggestionInteraction>,
    /// Pattern effectiveness metrics
    pub pattern_metrics: HashMap<String, PatternMetrics>,
    /// User coding sessions
    pub sessions: Vec<CodingSession>,
    /// Performance metrics
    pub performance: PerformanceMetrics,
}
```

### Suggestion

Represents a code suggestion generated by the system.

```rust
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct Suggestion {
    /// Unique suggestion ID
    pub id: String,
    /// Type of suggestion
    pub suggestion_type: SuggestionType,
    /// Suggested code
    pub code: String,
    /// Explanation of the suggestion
    pub explanation: String,
    /// Confidence score
    pub confidence: f64,
    /// Source pattern that generated this suggestion
    pub source_pattern: String,
    /// Context where suggestion applies
    pub context: SuggestionContext,
}
```

## Supporting Data Structures

### SourceLocation

Represents a location in source code.

```rust
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct SourceLocation {
    /// File path
    pub file: String,
    /// Starting line number (1-based)
    pub start_line: u32,
    /// Starting column number (1-based)
    pub start_column: u32,
    /// Ending line number (1-based)
    pub end_line: u32,
    /// Ending column number (1-based)
    pub end_column: u32,
}
```

### PatternFeedback

Represents user feedback on a pattern.

```rust
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct PatternFeedback {
    /// Timestamp of feedback
    pub timestamp: DateTime<Utc>,
    /// Type of feedback
    pub feedback_type: FeedbackType,
    /// Additional comments
    pub comments: Option<String>,
}
```

### VariableInfo

Information about variables in patterns.

```rust
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct VariableInfo {
    /// Variable name
    pub name: String,
    /// Variable type
    pub var_type: Option<String>,
    /// Possible values (for enums/constants)
    pub possible_values: Vec<String>,
}
```

### Placeholder

Represents a placeholder in string patterns.

```rust
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct Placeholder {
    /// Placeholder name
    pub name: String,
    /// Placeholder type
    pub placeholder_type: PlaceholderType,
    /// Default value
    pub default_value: Option<String>,
}
```

## Enumerations

### TokenType

```rust
#[derive(Debug, Clone, Serialize, Deserialize, PartialEq, Eq)]
pub enum TokenType {
    Keyword,
    Identifier,
    Literal,
    Operator,
    Punctuation,
    Comment,
    Whitespace,
}
```

### FeedbackType

```rust
#[derive(Debug, Clone, Serialize, Deserialize)]
pub enum FeedbackType {
    Accepted,
    Rejected,
    Modified,
    Ignored,
}
```

### SuggestionType

```rust
#[derive(Debug, Clone, Serialize, Deserialize)]
pub enum SuggestionType {
    Completion,
    Refactoring,
    Optimization,
    Documentation,
    ErrorFix,
}
```

### PlaceholderType

```rust
#[derive(Debug, Clone, Serialize, Deserialize)]
pub enum PlaceholderType {
    Variable,
    Type,
    Value,
    Expression,
    Statement,
}
```

## Usage Examples

### Creating a Simple Pattern

```rust
let pattern = CodingPattern {
    id: "func_pattern_001".to_string(),
    pattern_type: PatternType::FunctionDefinition,
    language: "javascript".to_string(),
    content: PatternContent::String {
        pattern: "function {name}({params}) { {body} }".to_string(),
        placeholders: vec![
            Placeholder {
                name: "name".to_string(),
                placeholder_type: PlaceholderType::Variable,
                default_value: Some("myFunction".to_string()),
            },
            Placeholder {
                name: "params".to_string(),
                placeholder_type: PlaceholderType::Expression,
                default_value: None,
            },
            Placeholder {
                name: "body".to_string(),
                placeholder_type: PlaceholderType::Statement,
                default_value: Some("// function body".to_string()),
            },
        ],
    },
    confidence: 0.85,
    frequency: 15,
    last_seen: Utc::now(),
    source_files: vec!["src/main.js".to_string()],
    user_feedback: vec![],
};
```

### Pattern Matching

```rust
impl CodingPattern {
    pub fn matches(&self, code: &str) -> Option<PatternMatch> {
        match &self.content {
            PatternContent::String { pattern, placeholders } => {
                // Implement string-based pattern matching
                self.match_string_pattern(code, pattern, placeholders)
            },
            PatternContent::Ast { nodes, variables } => {
                // Implement AST-based pattern matching
                self.match_ast_pattern(code, nodes, variables)
            },
            PatternContent::Tokens { tokens, metadata } => {
                // Implement token-based pattern matching
                self.match_token_pattern(code, tokens, metadata)
            },
        }
    }
}
```

## Storage and Serialization

All data structures implement `Serialize` and `Deserialize` for:
- **JSON serialization** for configuration files
- **Binary serialization** for performance-critical operations
- **Database storage** for persistent data
- **WebAssembly communication** between JS and Rust

## Future Extensions

The data structure design allows for easy extension:
- **New pattern types** can be added to `PatternType` enum
- **Language-specific patterns** through the `language` field
- **Complex pattern matching** via AST and token-based representations
- **Machine learning integration** through the `LearningData` structure
